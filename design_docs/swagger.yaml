openapi: 3.0.3
info:
  title: QC System - Permission & Menu Control API
  description: API documentation for the Quality Control System's RBAC and Menu management module.
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Local development server

paths:
  /api/auth/info:
    get:
      tags:
        - Authentication
      summary: Get current user info and roles
      parameters:
        - name: username
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          description: User not found

  /api/menu/user/{userId}:
    get:
      tags:
        - Menu
      summary: Get hierarchical menu tree for a user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Hierarchical menu tree
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuResponse'

  /api/menu/list:
    get:
      tags:
        - Menu
      summary: Get all menus (flat list for management)
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuResponse'

  /api/role/list:
    get:
      tags:
        - Role
      summary: List all roles
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoleResponse'

  /api/role:
    post:
      tags:
        - Role
      summary: Create a new role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'

  /api/role/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - Role
      summary: Update a role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
    delete:
      tags:
        - Role
      summary: Delete a role
      responses:
        '200':
          description: Deleted

  /api/user/list:
    get:
      tags:
        - User
      summary: Get users list (paginated)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 10
        - name: staffId
          in: query
          schema:
            type: string
        - name: managerId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Paginated users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageUserResponse'

  /api/user/managers:
    get:
      tags:
        - User
      summary: Get all line managers
      responses:
        '200':
          description: List of managers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /api/user:
    post:
      tags:
        - User
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: Created

  /api/user/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - User
      summary: Update user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: Updated
    delete:
      tags:
        - User
      summary: Delete user
      responses:
        '200':
          description: Deleted

  /api/process/list:
    get:
      tags:
        - Process
      summary: List all processes
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProcessResponse'

  /api/process:
    post:
      tags:
        - Process
      summary: Create process
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessRequest'
      responses:
        '200':
          description: Created

  /api/process/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - Process
      summary: Update process
      responses:
        '200':
          description: Updated
    delete:
      tags:
        - Process
      summary: Delete process
      responses:
        '200':
          description: Deleted

  /api/business/list:
    get:
      tags:
        - Business
      summary: List all business units
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessResponse'

  /api/business:
    post:
      tags:
        - Business
      summary: Create business
      responses:
        '200':
          description: Created

  /api/business/{id}:
    delete:
      tags:
        - Business
      summary: Delete business
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deleted

components:
  schemas:
    UserResponse:
      type: object
      example:
        id: "e277662d-428f-4030-84d4-f167c8a4610f"
        staffId: "40001"
        staffName: "admin"
        email: "admin@example.com"
        status: 1
        managerId: "e277662d-428f-4030-84d4-f167c8a46101"
        managerName: "Super Manager"
        roles:
          - roleId: "29adfeab-0e5d-48ab-85db-64800622053d"
            roleName: "Admin"
            roleDesc: "Administrator"
            status: 1
            menuIds: [1, 10, 11]
        processes: []
      properties:
        id:
          type: string
          format: uuid
        staffId:
          type: string
        staffName:
          type: string
        email:
          type: string
        status:
          type: integer
        managerId:
          type: string
          format: uuid
        managerName:
          type: string
        roles:
          type: array
          items:
            $ref: '#/components/schemas/RoleResponse'
        processes:
          type: array
          items:
            $ref: '#/components/schemas/ProcessResponse'

    UserRequest:
      type: object
      example:
        staffId: "40001"
        name: "David Staff"
        role: "Staff"
        status: 1
        lineManagerId: "29adfeab-0e5d-48ab-85db-648006220531"
        processes: ["PROC-uuid-1", "PROC-uuid-2"]
      properties:
        staffId:
          type: string
        name:
          type: string
        role:
          type: string
        lineManagerId:
          type: string
          format: uuid
        processes:
          type: array
          items:
            type: string

    RoleResponse:
      type: object
      example:
        roleId: "29adfeab-0e5d-48ab-85db-64800622053d"
        roleName: "Admin"
        roleDesc: "Administrator full access"
        status: 1
        menuIds: [1, 2, 3, 10, 11]
      properties:
        roleId:
          type: string
          format: uuid
        roleName:
          type: string
        roleDesc:
          type: string
        status:
          type: integer
        menuIds:
          type: array
          items:
            type: integer
            format: int64

    RoleRequest:
      type: object
      example:
        roleName: "QC Team Lead"
        roleDesc: "QC Team Lead permissions"
        menuIds: [1, 10, 12]
      properties:
        roleName:
          type: string
        roleDesc:
          type: string
        status:
          type: integer
        menuIds:
          type: array
          items:
            type: integer

    MenuResponse:
      type: object
      example:
        menuId: 1
        menuName: "Dashboard"
        parentId: 0
        sortOrder: 1
        path: "/dashboard"
        component: "Dashboard"
        menuType: "C"
        perms: "dashboard:view"
        icon: "DashboardOutlined"
        visible: 1
        children: []
      properties:
        menuId:
          type: integer
          format: int64
        menuName:
          type: string
        parentId:
          type: integer
          format: int64
        sortOrder:
          type: integer
        path:
          type: string
        component:
          type: string
        menuType:
          type: string
          enum: [D, C, F]
        perms:
          type: string
        icon:
          type: string
        visible:
          type: integer
        children:
          type: array
          items:
            $ref: '#/components/schemas/MenuResponse'

    ProcessResponse:
      type: object
      example:
        id: "29adfeab-0e5d-48ab-85db-64800622053d"
        business:
          id: "29adfeab-0e5d-48ab-85db-64800622053d"
          businessCode: "COL"
          businessName: "Collection Business Unit"
        procCode: "COL -- NHI25 -- Collection China Shanghai"
        procAid: "NHI25"
        procName: "Collection China Shanghai"
        qltyTarget: 95
        status: 1
      properties:
        id:
          type: string
          format: uuid
        procCode:
          type: string
        procAid:
          type: string
        procName:
          type: string
        bizCode:
          type: string
        qltyTarget:
          type: integer
        status:
          type: integer
        business:
          type: object
          properties:
            businessCode:
              type: string
            businessName:
              type: string

    ProcessRequest:
      type: object
      example:
        businessId: "29adfeab-0e5d-48ab-85db-64800622053d"
        procAid: "NHI25"
        procName: "Collection China Shanghai"
        qltyTarget: 95
        status: 1
      properties:
        businessId:
          type: string
          format: uuid
        procAid:
          type: string
        procName:
          type: string
        qltyTarget:
          type: integer
        status:
          type: integer

    BusinessResponse:
      type: object
      example:
        id: "29adfeab-0e5d-48ab-85db-64800622053d"
        bizCode: "COLLECTION"
        bizName: "Collection Business Unit"
        status: 1
      properties:
        id:
          type: string
          format: uuid
        bizCode:
          type: string
        bizName:
          type: string
        status:
          type: integer

    PageUserResponse:
      type: object
      example:
        content:
          - id: "29adfeab-0e5d-48ab-85db-64800622053d"
            staffId: "40001"
            staffName: "Alice Staff"
            email: "alice@example.com"
            status: 1
            managerId: "29adfeab-0e5d-48ab-85db-648006220531"
            managerName: "Super Manager"
            roles:
              - roleId: "29adfeab-0e5d-48ab-85db-64800622053a"
                roleName: "Staff"
                roleDesc: "Staff member"
                status: 1
                menuIds: [10, 11]
            processes:
              - id: "proc-uuid-1"
                procName: "Collection China"
        totalElements: 1
        totalPages: 1
        size: 10
        number: 0
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'
        totalElements:
          type: integer
        totalPages:
          type: integer
        size:
          type: integer
        number:
          type: integer
