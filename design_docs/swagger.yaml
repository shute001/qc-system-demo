openapi: 3.0.3
info:
  title: QC System - Permission & Menu Control API
  description: API documentation for the Quality Control System's RBAC and Menu management module.
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Local development server

paths:
  /api/v1/auth/info:
    get:
      tags:
        - Authentication
      summary: Get current user info and roles
      description: Get current user information and roles
      x-permission: "authenticated"
      parameters:
        - name: username
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/menu/user/{userId}:
    get:
      tags:
        - Menu
      summary: Get hierarchical menu tree for a user
      description: Get hierarchical menu tree for specific user based on their roles
      x-permission: "authenticated"
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Hierarchical menu tree
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuResponse'
                example:
                - menuId: 1
                  menuName: "Dashboard"
                  parentId: 0
                  sortOrder: 1
                  path: "/dashboard"
                  component: "Dashboard"
                  menuType: "C"
                  perms: ["dashboard:view"]
                  icon: "DashboardOutlined"
                  visible: 1
                  children: []
                - menuId: 10
                  menuName: "QC Management"
                  parentId: 0
                  sortOrder: 3
                  path: "/qc-module"
                  component: null
                  menuType: "D"
                  perms: []
                  icon: "FileProtectOutlined"
                  visible: 1
                  children:
                    - menuId: 11
                      menuName: "Sampling"
                      parentId: 10
                      sortOrder: 1
                      path: "sampling"
                      component: "qc/Sampling"
                      menuType: "C"
                      perms: ["qc:sampling:list"]
                      icon: null
                      visible: 1
                      children: []
                    - menuId: 15
                      menuName: "Inbox (To QC)"
                      parentId: 10
                      sortOrder: 2
                      path: "qc-inbox"
                      component: "qc/SamplingPage"
                      menuType: "C"
                      perms: ["qc:inbox:list"]
                      icon: null
                      visible: 1
                      children: []
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/menu/list:
    get:
      tags:
        - Menu
      summary: Get all menus (flat list for management)
      description: Get all menus for management
      x-permission: "system:menu:list"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/role/list:
    get:
      tags:
        - Role
      summary: List all roles
      description: Get all roles with their menu permissions
      x-permission: "system:role:list"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoleResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/role:
    post:
      tags:
        - Role
      summary: Create a new role
      description: Create a new role
      x-permission: "system:role:add"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/role/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - Role
      summary: Update a role
      description: Update role details and permissions
      x-permission: "system:role:edit"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Role
      summary: Delete a role
      description: Delete a role (only if no users assigned)
      x-permission: "system:role:delete"
      responses:
        '200':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/user/list:
    get:
      tags:
        - User
      summary: Get users list (paginated)
      description: Get all users with their details (paginated)
      x-permission: "system:user:list"
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          description: "Page size"
          schema:
            type: integer
            default: 10
        - name: staffId
          in: query
          schema:
            type: string
        - name: managerId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Paginated users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageUserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/user/managers:
    get:
      tags:
        - User
      summary: Get all line managers
      description: Get all users who act as line managers
      x-permission: "system:user:list"
      responses:
        '200':
          description: List of managers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/user:
    post:
      tags:
        - User
      summary: Create user
      description: Create a new user
      x-permission: "system:user:add"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: Created
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/user/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags:
        - User
      summary: Get user by ID
      description: Get user details by ID
      x-permission: "system:user:view"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - User
      summary: Update user
      description: Update user information
      x-permission: "system:user:edit"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - User
      summary: Delete user
      description: Soft delete/deactivate a user
      x-permission: "system:user:delete"
      responses:
        '200':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/process/list:
    get:
      tags:
        - Process
      summary: List all processes
      description: Get all processes
      x-permission: "system:process:list"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProcessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/process:
    post:
      tags:
        - Process
      summary: Create process
      description: Create a new process
      x-permission: "system:process:add"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProcessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/process/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags:
        - Process
      summary: Update process
      description: Update process details
      x-permission: "system:process:edit"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProcessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
        - Process
      summary: Delete process
      description: Delete a process (only if no users assigned)
      x-permission: "system:process:delete"
      responses:
        '200':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/business/list:
    get:
      tags:
        - Business
      summary: List all business units
      description: Get all business units (for dropdowns)
      x-permission: "system:business:list"
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/business:
    post:
      tags:
        - Business
      summary: Create business
      description: Create a new business unit
      x-permission: "system:business:add"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessRequest'
      responses:
        '200':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/business/{id}:
    delete:
      tags:
        - Business
      summary: Delete business
      description: Delete a business unit
      x-permission: "system:business:delete"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    UserResponse:
      type: object
      example:
        id: "e277662d-428f-4030-84d4-f167c8a4610f"
        staffId: "40001"
        staffName: "admin"
        email: "admin@example.com"
        status: 1
        managerId: "e277662d-428f-4030-84d4-f167c8a46101"
        managerName: "Super Manager"
        roles:
          - roleId: "29adfeab-0e5d-48ab-85db-64800622053d"
            roleName: "Admin"
            roleDesc: "Administrator"
            status: 1
        processes: []
      properties:
        id:
          type: string
          format: uuid
        staffId:
          type: string
        staffName:
          type: string
        email:
          type: string
        status:
          type: integer
        managerId:
          type: string
          format: uuid
        managerName:
          type: string
        roles:
          type: array
          items:
            $ref: '#/components/schemas/RoleResponse'
        processes:
          type: array
          items:
            $ref: '#/components/schemas/ProcessResponse'

    UserRequest:
      type: object
      example:
        staffId: "40001"
        staffName: "David Staff"
        roles: ["29adfeab-0e5d-48ab-85db-64800622053d", "29adfeab-0e5d-48ab-85db-64800622053e"]
        status: 1
        lineManagerId: "29adfeab-0e5d-48ab-85db-648006220531"
        processes: ["PROC-uuid-1", "PROC-uuid-2"]
      properties:
        staffId:
          type: string
        staffName:
          type: string
        roles:
          type: array
          items:
            type: string
          description: "List of role id to assign to user"
        lineManagerId:
          type: string
          format: uuid
        processes:
          type: array
          items:
            type: string

    RoleResponse:
      type: object
      example:
        roleId: "29adfeab-0e5d-48ab-85db-64800622053d"
        roleName: "Admin"
        roleDesc: "Administrator full access"
        status: 1
        menuIds: [1, 2, 3, 10, 11]
      properties:
        roleId:
          type: string
          format: uuid
        roleName:
          type: string
        roleDesc:
          type: string
        status:
          type: integer
        menuIds:
          type: array
          items:
            type: integer
            format: int64

    RoleRequest:
      type: object
      example:
        roleName: "Admin"
        roleDesc: "Administrator full access"
        status: 1
        menuIds: [1, 2, 3, 10, 11]
      properties:
        roleName:
          type: string
        roleDesc:
          type: string
        status:
          type: integer
        menuIds:
          type: array
          items:
            type: integer

    MenuResponse:
      type: object
      example:
        menuId: 1
        menuName: "Dashboard"
        parentId: 0
        sortOrder: 1
        path: "/dashboard"
        component: "Dashboard"
        menuType: "C"
        perms: "dashboard:view"
        icon: "DashboardOutlined"
        visible: 1
        children: []
      properties:
        menuId:
          type: integer
          format: int64
        menuName:
          type: string
        parentId:
          type: integer
          format: int64
        sortOrder:
          type: integer
        path:
          type: string
        component:
          type: string
        menuType:
          type: string
          enum: [D, C, F]
        perms:
          type: string
        icon:
          type: string
        visible:
          type: integer
        children:
          type: array
          items:
            $ref: '#/components/schemas/MenuResponse'

    ProcessResponse:
      type: object
      example:
        id: "29adfeab-0e5d-48ab-85db-64800622053d"
        business:
          id: "29adfeab-0e5d-48ab-85db-64800622053d"
          businessCode: "COL"
          businessName: "Collection Business Unit"
        procCode: "COL -- NHI25 -- Collection China Shanghai"
        procAid: "NHI25"
        procName: "Collection China Shanghai"
        qltyTarget: 95
        status: 1
      properties:
        id:
          type: string
          format: uuid
        procCode:
          type: string
        procAid:
          type: string
        procName:
          type: string
        bizCode:
          type: string
        qltyTarget:
          type: integer
        status:
          type: integer
        business:
          type: object
          properties:
            businessCode:
              type: string
            businessName:
              type: string

    ProcessRequest:
      type: object
      example:
        businessId: "29adfeab-0e5d-48ab-85db-64800622053d"
        procAid: "NHI25"
        procName: "Collection China Shanghai"
        qltyTarget: 95
        status: 1
      properties:
        businessId:
          type: string
          format: uuid
        procAid:
          type: string
        procName:
          type: string
        qltyTarget:
          type: integer
        status:
          type: integer

    BusinessRequest:
      type: object
      example:
        bizCode: "COLLECTION"
        bizName: "Collection Business Unit"
        status: 1
      properties:
        bizCode:
          type: string
        bizName:
          type: string
        status:
          type: integer

    BusinessResponse:
      type: object
      example:
        id: "29adfeab-0e5d-48ab-85db-64800622053d"
        bizCode: "COLLECTION"
        bizName: "Collection Business Unit"
        status: 1
      properties:
        id:
          type: string
          format: uuid
        bizCode:
          type: string
        bizName:
          type: string
        status:
          type: integer

    PageUserResponse:
      type: object
      example:
        page: 1
        pageSize: 10
        totalPages: 1
        totalElements: 1
        content:
          - id: "29adfeab-0e5d-48ab-85db-64800622053d"
            staffId: "40001"
            staffName: "Alice Staff"
            email: "alice@example.com"
            status: 1
            managerId: "29adfeab-0e5d-48ab-85db-648006220531"
            managerName: "Super Manager"
            roles:
              - roleId: "29adfeab-0e5d-48ab-85db-64800622053a"
                roleName: "Staff"
                roleDesc: "Staff member"
                status: 1
            processes:
              - id: "proc-uuid-1"
                procName: "Collection China"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'
        totalElements:
          type: integer
        totalPages:
          type: integer
        page:
          type: integer
        pageSize:
          type: integer

    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string

  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Authentication failed or token expired
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Permission denied
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
